{% extends 'base.html' %}

{% block header %}
<h2 style="display:inline-block;">{% block title %}News Feed Items{% endblock %}</h2>
{% if g.user %}
<a class="w3-margin" href="{{ url_for('rss_feed.add_feed') }}">
    <i class="material-icons">add</i><span class="w3-hide-small">Add New Feed</span></a>
{% if feed_name %}
<a class="w3-margin" href="{{ url_for('rss_feed.get_items', feed_id=feed_id) }}">
    <i class="material-icons">refresh</i><span class="w3-hide-small">Refresh Feed</span></a>
<a class="w3-margin" href="{{ url_for('rss_feed.mark_read_all', feed_id=feed_id) }}">
    <i class="material-icons">done_all</i><span class="w3-hide-small">Mark Feed Read</span></a>
{% else %}
<a class="w3-margin" href="{{ url_for('rss_feed.get_items') }}">
    <i class="material-icons">refresh</i><span class="w3-hide-small">Refresh All Feeds</span></a>
<a class="w3-margin" href="{{ url_for('rss_feed.mark_read_all') }}">
    <i class="material-icons">done_all</i><span class="w3-hide-small">Mark All Read</span></a>
{% endif %}
{% endif %}
{% endblock %}

{% block content %}
<div class="w3-container w3-margin-bottom">
    <a class="w3-btn w3-light-grey" id="show_read">Show Read</a>
    {% if feed_name %}
    <a class="w3-btn w3-light-grey" href="{{ url_for(request.url_rule.endpoint, feed_id=feed_id, sort=sort_order_opp) }}">
        <div id="sort_order">Sort {{ sort_order_opp }}</div>
    </a>
    <a class="w3-btn w3-light-grey" href="{{ url_for('rss_feed.bookmarked_index', feed_id=feed_id) }}">
        <div id="bookmark">Feed Bookmarks</div>
    </a>
    {% else %}
    <a class="w3-btn w3-light-grey" href="{{ url_for(request.url_rule.endpoint, sort=sort_order_opp) }}">
        <div id="sort_order">Sort {{ sort_order_opp }}</div>
    </a>
    <a class="w3-btn w3-light-grey" href="{{ url_for('rss_feed.bookmarked_index') }}">
        <div id="bookmark">Bookmarks</div>
    </a>
    {% endif %}
</div>
{% if feed_name %}
<div class="w3-container w3-margin-bottom">
    <a href="{{ url_for('rss_feed.feed_index', feed_id=feed_id) }}">{{ feed_name }}</a>
    <a href="{{ url_for('rss_feed.edit_feed', id=feed_id) }}">
        <!-- <img class="icon" src="{{ url_for('static', filename='icons/settings-icon.svg') }}" alt="Feed Settings" /> -->
        <i class="material-icons w3-small">settings</i>
    </a>
</div>
{% endif %}
<script type="text/javascript" src="{{ url_for('static', filename='js/mark_read.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/show_hide.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/bookmark.js') }}"></script>
{% for item in items %}
<article class="w3-card w3-margin-bottom w3-leftbar w3-border-light-blue item {% if item.UserItem.read %}read w3-hide{% else %}unread{% endif %}" id="{{ item.Item.id }}">
    <div class="w3-container">
        <header>
            {% if item.UserItem.bookmark %}
                <a class="w3-right w3-button w3-circle bookmark w3-xlarge" data-id="{{ item.Item.id }}" data-marked="true">
                    <i class="material-icons">bookmark</i>
                </a>
                
                {% else %}
                <a class="w3-right w3-button w3-circle bookmark w3-xlarge" data-id="{{ item.Item.id }}" data-marked="false">
                    <i class="material-icons">bookmark_border</i>
                </a>
                
            {% endif %}
                    <a href="{{ item.Item.link }}">
                        <h3>{{ item.Item.title }}</h3>
                    </a>
                    <em>from 
                        <a href="/{{ item.Item.feed_id }}">
                            {% if item.UserFeed.user_feed_name %}
                            {{ item.UserFeed.user_feed_name }}
                            {% else %}
                            {{ item.Feed.name }}
                            {% endif %}
                        </a> 
                        on {{ item.Item.publication_date|datetimeformat }}
                    </em>
            </header>
            <p>{{ item.Item.description|safe|truncate }}</p>
            <p>
                {% if item.UserItem.read %}
                    <a class="w3-btn w3-light-grey marker" data-id="{{ item.Item.id }}" data-read="true">Mark Unread</a>
                {% else %}
                    <a class="w3-btn w3-light-grey marker" data-id="{{ item.Item.id }}" data-read="false">Mark Read</a>
                {% endif %}
            </p>
        </div>
    </article>
    {% endfor %}
    
    <div class="w3-panel w3-pale-green w3-display-container">No more articles in feed.</div>
    {% endblock %}